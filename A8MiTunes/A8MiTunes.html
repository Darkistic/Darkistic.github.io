<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>A8MiTunes</title>

		<script src="music.js"></script>
		<script>

			function editStyle() {

				if (document.getElementById('search').value == 'search...') {
					document.getElementById('search').style = 'font-size:40px; color:grey; width:66%;';
				}
				else {
					document.getElementById('search').style = 'font-size:40px; color:black; width:66%;';
				}
			}

			function editSearch() {

				var input = document.getElementById('search').value;
				var output = input;

				if (input == 'search...') {output = ''};
				if (input == '') {output = 'search...'};

				document.getElementById('search').value = output;
				editStyle();
			}

			function addChar(x) {

				editSearch();

				var input = document.getElementById('search').value;
				var output = input;

				output += x.toLowerCase();
				document.getElementById('search').value = output;
				editStyle();
			}

			function showMedia() {

				var t = document.getElementById('track' + document.miTunes.trackSelect.selectedIndex).getAttribute('i');
				var a = document.getElementById('album' + document.miTunes.albumSelect.selectedIndex).getAttribute('i');
				var m = albums[a].tracks[t].mp3;

				var art =
					'<img src="artwork/'
					+albums[a].artwork
					+'.jpg" class="art">'

				var song =
					'<audio controls style="width:100%"><source src="audio/'
					+albums[a].artist
					+'/'
					+albums[a].title
					+'/'
					+m
					+'" type="audio/mpeg">'
					+'<source src="audio/'
					+albums[a].artist
					+'/'
					+albums[a].title
					+'/'
					+m.substring(0, m.length-4)
					+'.wav" type="audio/wav">'
					+'Your browser does not support the audio element.</audio>'

				var lyric =
					'<textarea rows="8" class="lyrics" readonly>'
					+albums[a].tracks[t].lyrics
					+'</textarea>'

				document.getElementById("art").innerHTML = art;
				document.getElementById("player").innerHTML = song;
				document.getElementById("lyrics").innerHTML = lyric;
			}

			function showTracks() {

				var x = 0;
				var album = document.getElementById('album' + document.miTunes.albumSelect.selectedIndex).getAttribute('i');
				var albumLength = albums[album].tracks.length;
				var search = document.getElementById('search').value;
				var html = '<select size="16" id="trackSel" name="trackSelect" onchange="showMedia()" style="font-size:24px; width:100%;">';

					for (i=0; i<albumLength; i++) {

						//###################################################
						//alert('album: ' + album + albums[album].title + '\ntrack: ' + i + albums[album].tracks[i].title + '\nindex in title: ' + albums[album].tracks[i].title.indexOf(search) + '\nindex in lyrics: ' + albums[album].tracks[i].lyrics.indexOf(search) + '\nsearch length: ' + search.length + '\nsearch: ' + search)

						if (albums[album].tracks[i].title.indexOf(search) !== -1 || albums[album].tracks[i].lyrics.indexOf(search) !== -1 || search.length < 2 || search == 'search...') {

							html +=
								'<option id="track'
								+x
								+'" i="'
								+i
								+'">'
								+albums[album].tracks[i].title
								+'</option>'

							x++;
						}
					}

				html += '</select>';
				document.getElementById('tracks').innerHTML = html;
			}

			function showAlbums() {

				var x = 0;
				var search = document.getElementById('search').value;
				var html = '<select size="16" id="albumSel" name="albumSelect" onchange="showTracks()" style="font-size:24px; width:100%;">';

				for (i=0; i<albums.length; i++) {

					for (j=0; j<albums[i].tracks.length; j++) {

						if (albums[i].tracks[j].title.indexOf(search) !== -1 || albums[i].tracks[j].lyrics.indexOf(search) !== -1 || search.length < 2 || search == 'search...') {

							html +=
								'<option id="album'
								+x
								+'" i="'
								+i
								+'">'
								+albums[i].title
								+'</option>'

							x++;

							break;
						}
					}
				}

				if (x > 0) {

					html += '</select>';
					document.getElementById('albums').innerHTML = html;

				} else {

					document.getElementById('albums').innerHTML = '<select size="16" id="albumSel" name="albumSelect" style="font-size:24px; width:100%;"><option></option></select>';
				}
			}

			function initKeyboard() {

				var keys = [
					['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
					['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
					['Z', 'X', 'C', 'V', 'B', 'N', 'M']
				]

				for (i=0; i<keys.length; i++) {

					var row = '';
					row +='<td colspan="3"><table class="keyboard"><tr><td>';

					for (j=0; j<keys[i].length; j++) {

						row +=
							'<input type="button" value="'
							+keys[i][j]
							+'" class="button" onclick="addChar(\''
							+keys[i][j]
							+'\'); showAlbums(); f();" />'
					}

					row += '</td></tr></table></td>';
					document.getElementById("row"+(i+1)).innerHTML = row;
				}
			}

			function f() {
				if (document.getElementById('albumSel').innerHTML !== '<option></option>') {
					document.miTunes.albumSelect.selectedIndex = 0;
					showTracks();
				} else {
					document.getElementById('tracks').innerHTML = '<select size="16" id="trackSel" name="trackSelect" style="font-size:24px; width:100%"><option></option></select>';
				}
			}

		</script>

		<style>

			.miTunes {
				max-width: 920px;
				min-width: 725px;
				border: 4px groove black;
				background-color: #77DDDD;
				width: 100%;
			}
			.top {
				vertical-align: top;
				padding-bottom: 4px;
				width: 28%;
			}
			.art {
				display: block;
				margin: auto;
				width: 100%;
			}
			.lyrics {
				min-height: 100px;
				max-height: 138px;
				resize: vertical;
				width: 97.5%;
			}
			.keyboard {
				text-align: center;
				width: 100%;
			}
			.button {
				text-align: center;
				font-size: 40px;
				width: 70px;
			}
			.reset-button {
				text-align: center;
				font-size: 40px;
				width: 140px;
			}

		</style>
	</head>

	<body>
		<h1 style="margin:10px; width:200px;">MiTunes</h1>
		<p style="position:absolute; left:170px; top:8px; min-width:229px;">Louis Meredith - cvljm2 - B623038</p>
		<div>
			<form name="miTunes">
				<table class="miTunes">
					<tr>
						<td id="albums" class="top"><select size="16" id="albumSel" name="albumSelect" style="font-size:24px; width:100%;"><option></option></select></td>
						<td id="tracks" class="top"><select size="16" id="trackSel" name="trackSelect" style="font-size:24px; width:100%;"><option></option></select></td>
						<td class="top">
							<span id="art"></span>
							<span id="player"></span>
							<span id="lyrics"></span>
						</td>
					</tr>
					<tr><td colspan="3" style="padding:4px; text-align:center; border-top: 4px groove black;">
						<!--should I use focusin?-->
						<input type="text" id="search" value="search..." onfocusin="editSearch();" onfocusout="editSearch();" onchange="showAlbums(); f();" style="font-size:40px; color:grey; width:66%;" />
						<input type="button" value="<-" class="button" onclick="var output=document.getElementById('search').value; if (output!=='search...') {output=output.substring(0,output.length-1); document.getElementById('search').value=output; editSearch(); showAlbums(); f();}" />
						<input type="button" value="reset" class="reset-button" onclick="document.getElementById('search').value='search...'; editStyle(); showAlbums(); f();" />
					</td></tr>
					<!--could do a loop for each row-->
					<tr id="row1"><td colspan="3"></td></tr>
					<tr id="row2"><td colspan="3"></td></tr>
					<tr id="row3"><td colspan="3"></td></tr>
					<tr><td colspan="3" style="padding:4px; text-align:center;"><input type="button" value="______" style="font-size:40px; width:60%;" onclick="addChar(' '); showAlbums(); f();" /></td></tr>
				</table>
			</form>
		</div>
		<script>showAlbums(); initKeyboard();</script>
	</body>
</html>
